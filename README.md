# Idle Grass Farm

Idle-–∞—Ä–∫–∞–¥–∞ –Ω–∞ Unity —Å –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º–æ–π —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ —Ç—Ä–∞–≤—ã –∏ –º–æ–¥—É–ª—å–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–æ–π.

## üéÆ –û –ø—Ä–æ–µ–∫—Ç–µ

–ü—Ä–æ—Ç–æ—Ç–∏–ø idle-–∏–≥—Ä—ã, –≥–¥–µ –∏–≥—Ä–æ–∫ —Å–∫–∞—à–∏–≤–∞–µ—Ç —Ç—Ä–∞–≤—É, –ø—Ä–æ–¥–∞–µ—Ç –µ—ë –∏ –ø—Ä–æ–∫–∞—á–∏–≤–∞–µ—Ç –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã. –û—Å–Ω–æ–≤–Ω–æ–π —Ñ–æ–∫—É—Å –Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏ —á–∏—Å—Ç—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É.

## üî• –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ —Ç—Ä–∞–≤—ã

**–ü—Ä–æ–±–ª–µ–º–∞:** –ù—É–∂–Ω–æ –æ—Ç—Ä–∏—Å–æ–≤–∞—Ç—å 2500+ —Ç—Ä–∞–≤–∏–Ω–æ–∫ —Å –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–π –Ω–∞–≥—Ä—É–∑–∫–æ–π –Ω–∞ CPU/GPU.

**–†–µ—à–µ–Ω–∏–µ:** `Graphics.DrawMeshInstanced` —Å –∫–∞—Å—Ç–æ–º–Ω—ã–º —à–µ–π–¥–µ—Ä–æ–º
- –ò–Ω—Å—Ç–∞–Ω—Å–∏–Ω–≥ 2500 –º–µ—à–µ–π –∑–∞ 1 draw call (–±–∞—Ç—á–∏–Ω–≥ –ø–æ 1023)
- –®–µ–π–¥–µ—Ä `Custom/GrassWind` —Å –ø—Ä–æ—Ü–µ–¥—É—Ä–Ω–æ–π –∞–Ω–∏–º–∞—Ü–∏–µ–π –≤–µ—Ç—Ä–∞ –≤ –≤–µ—Ä—à–∏–Ω–Ω–æ–º —à–µ–π–¥–µ—Ä–µ
- GPU –≤—ã—á–∏—Å–ª—è–µ—Ç –≤–æ–ª–Ω—ã –≤–µ—Ç—Ä–∞ –±–µ–∑ –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ CPU
- `MaterialPropertyBlock` –¥–ª—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ (trample —ç—Ñ—Ñ–µ–∫—Ç)

```csharp
// GrassFieldRenderer.cs
Graphics.DrawMeshInstanced(grassMesh, 0, grassMaterial, batch, batchSize, propertyBlock);
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** 5000+ —Ç—Ä–∞–≤–∏–Ω–æ–∫ @ 60 FPS

### –î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è–º–∏ —Ç—Ä–∞–≤—ã

–ö–∞–∂–¥–∞—è —Ç—Ä–∞–≤–∏–Ω–∫–∞ –∏–º–µ–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ (`isGrown`, `respawnTimer`) –∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ:
- Spatial culling —á–µ—Ä–µ–∑ —Ä–∞–¥–∏—É—Å —Ä–µ–∑–∫–∏
- Lazy regeneration (–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö)
- Memory layout: `struct GrassState` –¥–ª—è cache-friendly –¥–æ—Å—Ç—É–ø–∞

### NavMesh AI —Å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞–º–∏

–ö–∞—Å—Ç–æ–º–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –æ—á–µ—Ä–µ–¥–∏ –ø–æ–∫—É–ø–∞—Ç–µ–ª–µ–π:
- `NavMeshAgent.avoidancePriority` –¥–ª—è –∏–µ—Ä–∞—Ä—Ö–∏–∏ –¥–≤–∏–∂–µ–Ω–∏—è
- State machine –¥–ª—è NPC (`Wandering ‚Üí MovingToQueue ‚Üí InQueue ‚Üí Leaving`)
- Blend tree –∞–Ω–∏–º–∞—Ü–∏–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ `agent.velocity.magnitude`

```csharp
// Customer.cs
animator.SetFloat("Speed", agent.velocity.magnitude / agent.speed);
```

### Decoupled Event Architecture

–ü–æ–ª–Ω–æ—Å—Ç—å—é —Ä–∞–∑–¥–µ–ª–µ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –∞—É–¥–∏–æ –∏ VFX:

**Audio:**
- `AudioPlayer` - –Ω–∏–∑–∫–æ—É—Ä–æ–≤–Ω–µ–≤—ã–π playback (spawning, cleanup)
- `SoundManager` - –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ (–ø–æ–¥–ø–∏—Å–∫–∏ –Ω–∞ UnityEvent)
- Fade-out —á–µ—Ä–µ–∑ `UniTask` –±–µ–∑ –∫–æ—Ä—É—Ç–∏–Ω

**VFX:**
- `VFXPlayer` - —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Ä–∞–±–æ—Ç–∞ —Å Particle Systems
- `VFXManager` - –∏–≥—Ä–æ–≤–∞—è –ª–æ–≥–∏–∫–∞ —ç—Ñ—Ñ–µ–∫—Ç–æ–≤
- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è —Å–º–µ–Ω–∞ —Ü–≤–µ—Ç–∞ –ø–∞—Ä—Ç–∏–∫–ª–æ–≤ —á–µ—Ä–µ–∑ `Material.SetColor`

**–ü–æ—á–µ–º—É —Ç–∞–∫:**
- –ö–∞–∂–¥—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –∏–º–µ–µ—Ç –æ–¥–Ω—É –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å (SRP)
- –õ–µ–≥–∫–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ –∏–∑–æ–ª—è—Ü–∏–∏
- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –∑–≤—É–∫–æ–≤/—ç—Ñ—Ñ–µ–∫—Ç–æ–≤ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∏–≥—Ä–æ–≤–æ–π –ª–æ–≥–∏–∫–∏

### Zenject DI

Dependency Injection –≤–º–µ—Å—Ç–æ —Å–∏–Ω–≥–ª—Ç–æ–Ω–æ–≤:
```csharp
[Inject]
public void Construct(AudioPlayer audio, GrassCutter cutter) { ... }
```

–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:
- –Ø–≤–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –≤ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–µ
- –õ–µ–≥–∫–æ–µ —é–Ω–∏—Ç-—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (mock injection)
- –ù–∏–∫–∞–∫–∏—Ö `FindObjectOfType` –≤ —Ä–∞–Ω—Ç–∞–π–º–µ

### Dual Currency Economy

–î–≤–µ –≤–∞–ª—é—Ç—ã —Å —Ä–∞–∑–Ω—ã–º–∏ –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º–∏:
- ScriptableObject `GrassData` –¥–ª—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –Ω–∞–≥—Ä–∞–¥
- `MoneyManager` —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑—É–µ—Ç –ª–æ–≥–∏–∫—É
- UI –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ —Å–æ–±—ã—Ç–∏—è (–±–µ–∑ Update –ø–æ–ª–ª–∏–Ω–≥–∞)

### Performance Fixes

**–î–æ:** –õ–∞–≥ –ø—Ä–∏ 100+ –∫—É–±–∞—Ö —Ç—Ä–∞–≤—ã
**–ü—Ä–æ–±–ª–µ–º–∞:** `OnGUI()` –≤—ã–∑—ã–≤–∞–ª LINQ –∫–∞–∂–¥—ã–π –∫–∞–¥—Ä:
```csharp
var fullStacks = tableInventory.GetAllStacks().Where(s => s.IsFull).ToList();
```

**–†–µ—à–µ–Ω–∏–µ:** –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ + event-based –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
```csharp
tableInventory.onInventoryChanged.AddListener(MarkTextDirty);
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** 60 FPS —Å—Ç–∞–±–∏–ª—å–Ω–æ

## üõ† –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

- **Unity 2021.3+**
- **Zenject** - DI –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
- **UniTask** - async –±–µ–∑ –∞–ª–ª–æ–∫–∞—Ü–∏–π
- **NavMesh** - AI pathfinding
- **Graphics API** - DrawMeshInstanced
- **Shader Graph** - –ø—Ä–æ—Ü–µ–¥—É—Ä–Ω–∞—è –∞–Ω–∏–º–∞—Ü–∏—è

## üì¶ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
Assets/
‚îú‚îÄ‚îÄ _Scripts/
‚îÇ   ‚îú‚îÄ‚îÄ Audio/          # –ó–≤—É–∫–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞
‚îÇ   ‚îú‚îÄ‚îÄ VFX/            # –°–∏—Å—Ç–µ–º–∞ —ç—Ñ—Ñ–µ–∫—Ç–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ Grass/          # –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç—Ä–∞–≤–æ–π
‚îÇ   ‚îú‚îÄ‚îÄ Player/         # –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –∏ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å
‚îÇ   ‚îú‚îÄ‚îÄ Customer/       # AI –ø–æ–∫—É–ø–∞—Ç–µ–ª–µ–π
‚îÇ   ‚îú‚îÄ‚îÄ Economy/        # –í–∞–ª—é—Ç–∞ –∏ —Ç–æ—Ä–≥–æ–≤–ª—è
‚îÇ   ‚îî‚îÄ‚îÄ Installers/     # Zenject bindings
‚îú‚îÄ‚îÄ _Design/            # 3D –º–æ–¥–µ–ª–∏ –∏ —Ç–µ–∫—Å—Ç—É—Ä—ã
‚îî‚îÄ‚îÄ Scenes/             # MainScene
```

## üöÄ –ó–∞–ø—É—Å–∫

1. –ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
2. –û—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–æ–µ–∫—Ç –≤ Unity 6000.2+
3. –û—Ç–∫—Ä–æ–π—Ç–µ —Å—Ü–µ–Ω—É `MainScene`
4. Play

**–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
- WASD - –¥–≤–∏–∂–µ–Ω–∏–µ
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ä–µ–∑–∫–∞ —Ç—Ä–∞–≤—ã –ø—Ä–∏ –∫–æ–Ω—Ç–∞–∫—Ç–µ
